---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getComicBySlug, getAdjacentComics } from '@/lib/sanity';

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/');
}

const comic = await getComicBySlug(slug);

if (!comic) {
  return new Response('Comic not found', { status: 404 });
}

const { prev, next } = await getAdjacentComics(comic.publishedAt);
---

<BaseLayout title={comic.title}>
  <article>
    <h1>{comic.title}</h1>
    <p class="comic-meta">
      Published: {new Date(comic.publishedAt).toLocaleDateString()}
    </p>
    <img
      src={comic.imageUrl}
      alt={comic.altText || comic.title}
      class="comic-image"
    />
    {
      comic.transcript && (
        <details style="margin-top: 1rem;">
          <summary>Transcript</summary>
          <pre style="white-space: pre-wrap; background: #cce5ff; padding: 1rem; margin-top: 0.5rem; border-radius: 4px;">
            {comic.transcript}
          </pre>
        </details>
      )
    }
    
    <nav class="comic-nav">
      <div class="nav-prev">
        {prev ? (
          <a href={`/comic/${prev.slug.current}`} title={prev.title}>
            &larr; Previous
          </a>
        ) : (
          <span class="nav-disabled">&larr; Previous</span>
        )}
      </div>
      
      <div class="nav-center">
        <a href="/">Latest</a>
        <span class="nav-separator">|</span>
        <a href="/archive">Archive</a>
      </div>
      
      <div class="nav-next">
        {next ? (
          <a href={`/comic/${next.slug.current}`} title={next.title}>
            Next &rarr;
          </a>
        ) : (
          <span class="nav-disabled">Next &rarr;</span>
        )}
      </div>
    </nav>
  </article>
</BaseLayout>

<style>
  .comic-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 1.5rem;
    padding: 1rem 0;
    border-top: 2px solid #b3d9ff;
  }
  
  .nav-prev, .nav-next {
    min-width: 100px;
  }
  
  .nav-prev {
    text-align: left;
  }
  
  .nav-next {
    text-align: right;
  }
  
  .nav-center {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }
  
  .nav-separator {
    color: #80b3e6;
  }
  
  .nav-disabled {
    color: #80b3e6;
    cursor: default;
  }
  
  .comic-nav a {
    text-decoration: none;
    color: #0052a3;
  }
  
  .comic-nav a:hover {
    text-decoration: underline;
  }
</style>
