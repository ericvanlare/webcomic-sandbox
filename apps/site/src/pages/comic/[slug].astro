---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getComicBySlug, getAdjacentComics } from '@/lib/sanity';

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/');
}

const comic = await getComicBySlug(slug);

if (!comic) {
  return new Response('Comic not found', { status: 404 });
}

const { prev, next } = await getAdjacentComics(comic.publishedAt);
---

<BaseLayout title={comic.title}>
  <article>
    <h1>{comic.title}</h1>
    <p class="comic-meta">
      Published: {new Date(comic.publishedAt).toLocaleDateString()}
    </p>
    <img
      src={comic.imageUrl}
      alt={comic.altText || comic.title}
      class="comic-image"
    />
    {
      comic.transcript && (
        <details>
          <summary>Transcript</summary>
          <pre>{comic.transcript}</pre>
        </details>
      )
    }

    <nav class="comic-nav">
      <div class="nav-prev">
        {
          prev ? (
            <a href={`/comic/${prev.slug.current}`} title={prev.title}>
              &larr; Previous
            </a>
          ) : (
            <span class="nav-disabled">&larr; Previous</span>
          )
        }
      </div>

      <div class="nav-center">
        <a href="/">Latest</a>
        <span class="nav-separator">|</span>
        <a href="/archive">Archive</a>
      </div>

      <div class="nav-next">
        {
          next ? (
            <a href={`/comic/${next.slug.current}`} title={next.title}>
              Next &rarr;
            </a>
          ) : (
            <span class="nav-disabled">Next &rarr;</span>
          )
        }
      </div>
    </nav>
  </article>
</BaseLayout>

<style>
  .comic-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 16px;
    border: 2px solid #dee2e6;
  }

  .nav-prev,
  .nav-next {
    min-width: 120px;
  }

  .nav-prev {
    text-align: left;
  }

  .nav-next {
    text-align: right;
  }

  .nav-center {
    display: flex;
    gap: 0.75rem;
    align-items: center;
  }

  .nav-separator {
    color: #adb5bd;
    font-weight: 600;
  }

  .nav-disabled {
    color: #adb5bd;
    cursor: default;
    font-weight: 600;
    opacity: 0.5;
  }

  .comic-nav a {
    text-decoration: none;
    color: #6c5ce7;
    font-weight: 700;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    transition: all 0.3s ease;
    background: #ffffff;
    border: 2px solid transparent;
  }

  .comic-nav a:hover {
    background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
    color: #ffffff;
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(108, 92, 231, 0.3);
  }

  article {
    background: #ffffff;
    padding: 2rem;
    border-radius: 16px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  }
</style>
